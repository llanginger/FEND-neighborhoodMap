function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:myLatLong,zoom:15}),infoWindow=new google.maps.InfoWindow}function toggleBounce(){null!==marker.getAnimation()?marker.setAnimation(null):marker.setAnimation(google.maps.Animation.BOUNCE)}var myLatLongArray=[[47.6792,-122.386]],myLatLong={lat:47.6792,lng:-122.386},map,marker,infoWindow;$(function(){$(".nav-toggle").on("click",function(){$(".wrapper").toggleClass("open")}),$("#display-random").on("click",function(){$(".wrapper").toggleClass("open")});var e=function(){var e=this;this.searchLocation=ko.observable("ballard"),this.searchCategory=ko.observable("donuts"),this.resultName=ko.observable(),this.resultId=ko.observableArray([]),this.resultLimit=ko.observable(10),this.fourSquareResults=ko.observableArray([]),this.fourSqPhotos=ko.observableArray([]),this.currentPhoto=ko.observable(),this.selectedItems=ko.observableArray([]),this.currentItem=ko.observable({});var o,t={};this.removeSelected=function(){e.fourSquareResults.removeAll(e.selectedItems()),e.selectedItems([])},this.fourSquareApiCall=function(){e.fourSquareResults([]),t={baseUrl:"https://api.foursquare.com/v2/venues/",search:"search?",clientID:"client_id=WGMJMEF5PGBY0Z2VPGOTUV4IZWYTZS5V1E0TPIJHBSHRXNWS",clientSecret:"&client_secret=MPIRWAHDMNBZVY2LSAVR1Y0WLQEP5SLDQHIXJZLVFILJHJDQ",loc:"near="+e.searchLocation(),cat:"&query="+e.searchCategory(),limit:"&limit="+e.resultLimit()};var o=t.baseUrl+t.search+t.loc+"&"+t.clientID+t.clientSecret+"&v=20130815"+t.cat+t.limit;console.log(t.loc),console.log(o),e.fourSquareResults([]),$.ajax(o).fail(function(e){console.log("Failed 4square request")}).done(function(o){console.log(o);var r=o.response.venues,a;for(var i in r)a={name:r[i].name,lat:r[i].location.lat,lng:r[i].location.lng,id:r[i].id},n(a,t),console.log(a);console.log(e.fourSquareResults())})};var n=function(o,t){$.ajax({url:t.baseUrl+o.id+"/photos?"+t.clientID+t.clientSecret+"&v=20130815"}).fail(function(o){console.log("Failed 4square photo request"),console.log(e.resultId()[0])}).done(function(t){console.log(t);var n=t.response.photos.items,r=[];for(var a in n)r.push(n[a].prefix+"300x200"+n[a].suffix);r.length>0?o.photoString=r:o.photoString="images/noPhoto.jpg",e.fourSquareResults().push(o),console.log(e.fourSquareResults())})};this.displayRandom=function(){var o=Math.floor(Math.random()*e.fourSquareResults().length);e.currentItem(e.fourSquareResults()[o]);var n=e.currentItem().lat,a=e.currentItem().lng;e.resultName(e.currentItem().name),e.resultId(e.currentItem().id),e.currentPhoto(e.currentItem().photoString),t.id=e.currentItem().id,console.log(e.fourSquareResults()),console.log(e.currentItem()),console.log(e.currentItem().photoString[0]),myLatLong={lat:n,lng:a},map.panTo(myLatLong),marker?marker.setPosition(myLatLong):marker=new google.maps.Marker({position:myLatLong,map:map,title:"Ohai, a marker!",animation:google.maps.Animation.DROP}),infoWindow&&infoWindow.close(),infoWindow=new google.maps.InfoWindow({content:"<div id='content'><div class='default-slider'><ul><li><img src='"+e.currentItem().photoString[0]+"' class='image-slide'  /></li><li><img src='"+e.currentItem().photoString[1]+"' class='image-slide'  /></li><li><img src='"+e.currentItem().photoString[2]+"' class='image-slide'  /></li></ul></div><h1 id='firstHeading' class='firstHeading'>"+e.resultName()+"</h1></div>"}),marker.setPosition(myLatLong),infoWindow.open(map,marker,this),$(".default-slider").unslider({autoplay:!0,speed:1e3}),r(myLatLong,0,-150)};var r=function(e,o,t){var n=map.getProjection().fromLatLngToPoint(e instanceof google.maps.LatLng?e:map.getCenter()),r=new google.maps.Point(o/Math.pow(2,map.getZoom())||0,t/Math.pow(2,map.getZoom())||0);map.setCenter(map.getProjection().fromPointToLatLng(new google.maps.Point(n.x-r.x,n.y+r.y)))}};ko.applyBindings(new e)});