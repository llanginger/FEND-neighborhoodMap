function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:myLatLong,zoom:15}),infoWindow=new google.maps.InfoWindow}function toggleBounce(){null!==marker.getAnimation()?marker.setAnimation(null):marker.setAnimation(google.maps.Animation.BOUNCE)}var myLatLongArray=[[47.6792,-122.386]],myLatLong={lat:47.6792,lng:-122.386},map,marker,infoWindow,michaelId;$(function(){$(".nav-toggle").on("click",function(){$(".wrapper").toggleClass("open")}),$("#display-random").on("click",function(){$(".wrapper").toggleClass("open")}),$("#main-button").on("click",function(){$(".default-slider").unslider()});var o=function(){var o=this;this.googleMap=map,this.searchLocation=ko.observable("ballard, wa"),this.searchCategory=ko.observable("coffee"),this.resultName=ko.observable(),this.resultId=ko.observableArray([]),this.resultLimit=ko.observable(10),this.fourSquareResults=ko.observableArray([]),this.fourSqPhotos=ko.observableArray([]),this.currentPhoto=ko.observable(),this.selectedItems=ko.observableArray([]),this.currentItem=ko.observable({}),this.fourSqSettings=ko.observable({baseUrl:"https://api.foursquare.com/v2/venues/",search:"search?",clientID:"client_id=WGMJMEF5PGBY0Z2VPGOTUV4IZWYTZS5V1E0TPIJHBSHRXNWS",clientSecret:"&client_secret=MPIRWAHDMNBZVY2LSAVR1Y0WLQEP5SLDQHIXJZLVFILJHJDQ",loc:"near="+o.searchLocation(),cat:"&query="+o.searchCategory(),limit:"&limit="+o.resultLimit()});var e=o.fourSqSettings().baseUrl+o.fourSqSettings().search+o.fourSqSettings().loc+"&"+o.fourSqSettings().clientID+o.fourSqSettings().clientSecret+"&v=20130815"+o.fourSqSettings().cat+o.fourSqSettings().limit,t,n;this.removeSelected=function(){o.fourSquareResults.removeAll(o.selectedItems()),o.selectedItems([])},this.displayRandom=function(){var e=Math.floor(Math.random()*o.fourSquareResults().length);o.currentItem(o.fourSquareResults()[e]);var t=o.currentItem().lat,a=o.currentItem().lng;o.resultName(o.currentItem().name),o.resultId(o.currentItem().id),o.fourSqSettings().id=o.currentItem().id,myLatLong={lat:t,lng:a},map.panTo(myLatLong),marker?marker.setPosition(myLatLong):marker=new google.maps.Marker({position:myLatLong,map:map,title:"Ohai, a marker!",animation:google.maps.Animation.DROP}),infoWindow&&infoWindow.close(),infoWindow=new google.maps.InfoWindow({content:"<div id='content'><div class='default-slider'><ul><li><img src='"+n+"' /></li></ul></div><h1 id='firstHeading' class='firstHeading'>"+o.resultName()+"</h1></div>"}),marker.setPosition(myLatLong),infoWindow.open(map,marker,this),r(myLatLong,0,-150)};var r=function(o,e,t){var n=map.getProjection().fromLatLngToPoint(o instanceof google.maps.LatLng?o:map.getCenter()),r=new google.maps.Point(e/Math.pow(2,map.getZoom())||0,t/Math.pow(2,map.getZoom())||0);map.setCenter(map.getProjection().fromPointToLatLng(new google.maps.Point(n.x-r.x,n.y+r.y)))};this.fourSquareApiCall=function(){o.fourSquareResults([]),$.ajax(e).fail(function(o){console.log("Failed 4square request")}).done(function(e){console.log(e);var n=e.response.venues;for(var r in n)o.fourSquareResults.push({name:n[r].name,lat:n[r].location.lat,lng:n[r].location.lng,id:n[r].id}),o.resultId.push(n[r].id);console.log(o.resultId()[0]),t=o.fourSqSettings().baseUrl+o.resultId()[0]+"/photos?"+o.fourSqSettings().clientID+o.fourSqSettings().clientSecret+"&v=20130815",console.log(t)})},this.fourSquarePhotoCall=function(){console.log(o.resultId()[0]),console.log(t),$.ajax(t).fail(function(e){console.log("Failed 4square photo request"),console.log(o.resultId()[0])}).done(function(e){console.log(e);var t=e.response.photos.items;for(var r in t)o.fourSqPhotos.push({prefix:t[r].prefix,suffix:t[r].suffix});o.currentPhoto(o.fourSqPhotos()[0]),n=o.currentPhoto().prefix+"300x200"+o.currentPhoto().suffix,console.log(n)}),console.log(o.fourSqPhotos()),o.fourSqPhotos([])}};ko.applyBindings(new o)});